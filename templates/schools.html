{% extends "layout.html" %}

{% block title %}Schools{% endblock %}

{% block content %}
<div class="d-flex justify-content-between mb-3">
  <h2 class="page-title">Schools</h2>
  <!--<a href="{{ url_for('upload.upload_schools')}}" class="btn btn-primary">Bulk insert Schools</a>-->
</div>

<div class="d-flex justify-content-between"></div>
  <a href="{{ url_for('register.register_report') }}" class="btn btn-primary btn-sm">
    Report
  </a>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table table-vcenter card-table" id="schoolsTable">
      <thead>
        <tr>
          <th>EMIS</th>
          <th>Name</th>
          <th>Registers</th>
          <th class="w-1">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for school in schools %}
        <tr>
          <td><a href="{{ url_for('school.details', emis=school.emis) }}">{{ school.emis }}</a></td>
          <td><a href="{{ url_for('school.details', emis=school.emis) }}" >{{ school.name }}</a></td>
          <td>{{ school.registers|length }}</td>
          <td>
            <div class="btn-list flex-nowrap">
              <a href="#" class="btn btn-sm btn-outline-secondary">Edit</a>
              <a href="{{ url_for('register.school_registers', school_id=school.id) }}" class="btn btn-sm btn-outline-info">Registers</a>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
{% block scripts %}
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    let len = {{ schools|length }};
    console.log(len);
    let table = $('#schoolsTable').DataTable({
      "pageLength": 100,
      "lengthMenu": [ [10, 25, 50,100, -1], [10, 25, 50,100, "All"] ],
      "order": [[1, "asc"]], // Order by second column (index 1) ascending by default
      "columnDefs": [
        { "orderable": false, "targets": [-1] } // Disable sorting on the last column (Actions)
      ]
    });
    // Add custom classes to the search bar and set placeholder
    var $searchInput = $('.dataTables_filter input[type="search"]');
    $searchInput.addClass('form-control form-control-sm').attr('placeholder', 'Search');
    // Remove the 'Search' label text
    $('.dataTables_filter label').contents().filter(function() {
      return this.nodeType === 3 && this.textContent.match(/search/i);
    }).remove();
    // Move the input into a new centered div
    var $filter = $('.dataTables_filter');
    var $centerDiv = $('<div class="w-100 d-flex justify-content-center"></div>');
    $searchInput.appendTo($centerDiv);
    $filter.empty().append($centerDiv);
  });
  </script>
{% endblock %}