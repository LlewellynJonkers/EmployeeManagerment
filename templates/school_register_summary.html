{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
  <h2>School register summary</h2>
  <div>
    <a href="{{ url_for('school.details',emis=school.emis) }}" class="btn btn-secondary btn-sm mb-3">&larr; Back to School Details</a>
  </div>
  <div>
    <form class="form mb-3" method="GET">
      <div class="form-group">
        <label for="start_date">Select Week Starting:</label>
        <input type="date" id="start_date" name="start_date" class="form-control" value="{{ start_date }}">
      </div>
      <div class="form-group mt-2">
        <label for="end_date">Select Week Ending:</label>
        <input type="date" id="end_date" name="end_date" class="form-control" value="{{ end_date }}">  
      </div>
        <button type="submit" class="btn btn-primary btn-sm mt-2">Filter</button>
    </form>
  </div>
  <div>
    <table class="table table-bordered" summary="Employee Register Summary" id="summaryTable">
      <thead class="table-light">
        <tr>
            <th>Employee</th>
            {% for status in statuses %}
                <th>{{ status|capitalize }}</th>
            {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for emp in employees %}
        <tr>
          <td><a href="{{ url_for('employee.summary', employee_id=emp.id)}}">{{ emp.surname }}, {{ emp.firstname }}</a></td>
            {% for status in statuses %}
                <td>{{ summary[emp.id].get(status, 0) }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div>
        <h5>Notes</h5>
        {% if notes %}
            <ul>
                {% for week, note in notes.items() %}
                    <li><strong>{{ week }}:</strong> {{ note }}</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No notes available for the selected period.</p>
        {% endif %}
  </div>
{% endblock %}

{% block scripts %}
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const table = document.getElementById('summaryTable');
    const rows  = table.tBodies[0].rows;
    const cols  = table.tHead.rows[0].cells.length;

    // Walk columns right-to-left so hiding doesnâ€™t shift indexes
    for (let c = cols - 1; c >= 0; c--) {
      let allZero = true;

      for (let r = 0; r < rows.length; r++) {
        const text = rows[r].cells[c].innerText.trim();
        // test for numeric 0 (ignore blanks and non-numbers as "not zero")
        if (text !== '0' && text !== '0.0' && text !== '0.00') {
          allZero = false;
          break;
        }
      }

      if (allZero) {
        // hide the header cell
        table.tHead.rows[0].cells[c].style.display = 'none';
        // hide each body cell in that column
        for (let r = 0; r < rows.length; r++) {
          rows[r].cells[c].style.display = 'none';
        }
      }
    }
  });
  </script>
{% endblock %}
  